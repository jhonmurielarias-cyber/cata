<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Ficha de Catación de Café</title>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f2f2f2;
    padding:15px;
}
.cuadro{
    background:white;
    padding:20px;
    border-radius:8px;
    max-width:500px;
    margin:auto;
    box-shadow:0 0 10px rgba(0,0,0,0.15);
}
h2{ text-align:center; }
.grupo{ margin-bottom:20px; }
label.titulo{
    font-weight:bold;
    display:block;
    margin-bottom:5px;
}
.opciones label{
    display:block;
}
textarea{
    width:100%;
    height:55px;
    margin-top:5px;
    resize:none;
    padding:5px;
    font-size:14px;
}
input[type="number"], input[type="text"]{
    width:100%;
    padding:6px;
    font-size:15px;
}
button{
    width:100%;
    padding:10px;
    font-size:16px;
    background:#4CAF50;
    color:white;
    border:none;
    border-radius:5px;
    cursor:pointer;
}
button:hover{
    background:#45a049;
}
#listaCataciones{
    margin-top:20px;
}
.catacionItem{
    background:#f9f9f9;
    padding:10px;
    border-radius:5px;
    margin-bottom:10px;
    font-size:14px;
}
</style>
</head>

<body>

<div class="cuadro">
<h2>Ficha de Catación de Café</h2>

<label class="titulo">Lote / Muestra</label>
<input type="text" id="lote" placeholder="Ej. Café de mi finca">

<!-- FRAGANCIA -->
<div class="grupo">
<label class="titulo">Fragancia / Aroma</label>
<div class="opciones" id="fragancia">
<label><input type="checkbox" value="Floral"> Floral</label>
<label><input type="checkbox" value="Frutal"> Frutal</label>
<label><input type="checkbox" value="Cítrico"> Cítrico</label>
<label><input type="checkbox" value="Dulce"> Dulce</label>
<label><input type="checkbox" value="Té / Herbal"> Té / Herbal</label>
<label><input type="checkbox" value="Limpio"> Limpio</label>
</div>
<textarea id="fragObs" placeholder="Apreciación de fragancia (opcional)"></textarea>
</div>

<!-- SABOR -->
<div class="grupo">
<label class="titulo">Sabor</label>
<div class="opciones" id="sabor">
<label><input type="checkbox" value="Dulce"> Dulce</label>
<label><input type="checkbox" value="Frutal jugoso"> Frutal jugoso</label>
<label><input type="checkbox" value="Floral"> Floral</label>
<label><input type="checkbox" value="Cítrico"> Cítrico</label>
<label><input type="checkbox" value="Té"> Té</label>
<label><input type="checkbox" value="Miel"> Miel</label>
<label><input type="checkbox" value="Chocolate suave"> Chocolate suave</label>
</div>
<textarea id="saborObs" placeholder="Apreciación de sabor (opcional)"></textarea>
</div>

<!-- ACIDEZ -->
<div class="grupo">
<label class="titulo">Acidez</label>
<div class="opciones" id="acidez">
<label><input type="checkbox" value="Media"> Media</label>
<label><input type="checkbox" value="Alta"> Alta</label>
<label><input type="checkbox" value="Brillante"> Brillante</label>
<label><input type="checkbox" value="Cítrica"> Cítrica</label>
<label><input type="checkbox" value="Málica"> Málica</label>
<label><input type="checkbox" value="Elegante"> Elegante</label>
</div>
<textarea id="acidezObs" placeholder="Apreciación de acidez (opcional)"></textarea>
</div>

<!-- CUERPO -->
<div class="grupo">
<label class="titulo">Cuerpo</label>
<div class="opciones" id="cuerpo">
<label><input type="checkbox" value="Ligero"> Ligero</label>
<label><input type="checkbox" value="Medio"> Medio</label>
<label><input type="checkbox" value="Medio-alto"> Medio-alto</label>
<label><input type="checkbox" value="Sedoso"> Sedoso</label>
<label><input type="checkbox" value="Cremoso"> Cremoso</label>
</div>
<textarea id="cuerpoObs" placeholder="Apreciación de cuerpo (opcional)"></textarea>
</div>

<!-- PUNTAJE -->
<div class="grupo">
<label class="titulo">Puntaje Final (0 – 100)</label>
<input type="number" id="puntaje" min="0" max="100" placeholder="Ej. 88">
</div>

<button onclick="guardar()">Guardar Catación</button>

<!-- LISTA DE CATACIONES -->
<div id="listaCataciones"></div>

</div>

<script>
// BLOQUEO PUNTAJE >100
const puntaje = document.getElementById("puntaje");
puntaje.addEventListener("input", () => {
    if(puntaje.value > 100){
        alert("El puntaje máximo es 100");
        puntaje.value = 100;
    }
    if(puntaje.value < 0) puntaje.value = 0;
});

// Función para obtener valores de checkboxes
function getCheckboxValues(containerId){
    const checks = document.querySelectorAll(`#${containerId} input[type=checkbox]:checked`);
    return Array.from(checks).map(c => c.value);
}

// Función para guardar catación
function guardar(){
    const data = {
        fecha: new Date().toLocaleString(),
        lote: document.getElementById("lote").value,
        puntaje: puntaje.value,
        fragancia: getCheckboxValues("fragancia"),
        sabor: getCheckboxValues("sabor"),
        acidez: getCheckboxValues("acidez"),
        cuerpo: getCheckboxValues("cuerpo"),
        fraganciaObs: document.getElementById("fragObs").value,
        saborObs: document.getElementById("saborObs").value,
        acidezObs: document.getElementById("acidezObs").value,
        cuerpoObs: document.getElementById("cuerpoObs").value
    };

    let registros = JSON.parse(localStorage.getItem("cataciones")) || [];
    registros.push(data);
    localStorage.setItem("cataciones", JSON.stringify(registros));

    alert("Catación guardada ✔");
    mostrarCataciones();
    limpiarFormulario();
}

// Función para mostrar cataciones guardadas
function mostrarCataciones(){
    const lista = document.getElementById("listaCataciones");
    let registros = JSON.parse(localStorage.getItem("cataciones")) || [];
    lista.innerHTML = "<h3>Cataciones Guardadas:</h3>";
    registros.reverse().forEach((c, index) => {
        lista.innerHTML += `
        <div class="catacionItem">
            <strong>${c.lote}</strong> (${c.fecha}) - Puntaje: ${c.puntaje}<br>
            <em>Fragancia:</em> ${c.fragancia.join(", ")}<br>
            <em>Sabor:</em> ${c.sabor.join(", ")}<br>
            <em>Acidez:</em> ${c.acidez.join(", ")}<br>
            <em>Cuerpo:</em> ${c.cuerpo.join(", ")}<br>
            <em>Apreciaciones:</em><br>
            Fragancia: ${c.fraganciaObs}<br>
            Sabor: ${c.saborObs}<br>
            Acidez: ${c.acidezObs}<br>
            Cuerpo: ${c.cuerpoObs}
        </div>
        `;
    });
}

// Limpiar formulario después de guardar
function limpiarFormulario(){
    document.getElementById("lote").value = "";
    puntaje.value = "";
    ["fragancia","sabor","acidez","cuerpo"].forEach(id => {
        document.querySelectorAll(`#${id} input[type=checkbox]`).forEach(c => c.checked = false);
    });
    ["fragObs","saborObs","acidezObs","cuerpoObs"].forEach(id => document.getElementById(id).value = "");
}

// Mostrar al cargar la página
mostrarCataciones();
</script>

</body>
</html>
